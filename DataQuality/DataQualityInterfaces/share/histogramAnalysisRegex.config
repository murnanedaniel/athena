## This file illustrates the use of regular expressions to autogenerate
## output tree structure based on the input file.

#######################
# Histogram Assessments
#######################


## define the directory structure of the input file

dir eb1 {
  reference = default
  algorithm = CheckMean/Loose
  dir Stats {
    ## use regex with pattern in directory name
    dir (?P<dirgroup>G.*) {
      ## need to define regex = 1 at the first directory level that uses regexes
      ## it is automatically set for all directories/histograms contained inside
      regex = 1

      ## since we use the same histograms multiple times, need to use @LABEL syntax
      ## the @LABEL is ignored in the regex

      ## put even and odd histos in different output directories
      hist gaus_.*[02468]@1 {
        output = evens  
      }
      hist gaus_.*[13579]@1 {    
        output = odds  
      }

      ## split into different directories (with autogenerated names)
      ## based on first digit in name
      hist gaus_(?P<firstdigit>\d).*@2 {
        output = splitByDigit/${dirgroup}/digit_${firstdigit}
      }
     
      ## non-pattern output subdirectories of pattern output subdirectories should work
      hist gaus_.*[02468]@3 {
        output = splitByDigit/${dirgroup}/evens
      }

      ## use of backreferences inside the regular expression
      hist gaus_(?P<firstdigit>\d)(?P=firstdigit).*@4 {
        output = splitByDigit/${dirgroup}
      }
    }
  }
}


#############
# Output
#############

## The 'top_level' must always be defined
output top_level {

  algorithm = SimpleSummary
    
  output evens {
    }
  output odds {

  }
  ## outputs to match the patterns defined above.
  ## regex pattern names must match exactly.
  output splitByDigit {
    output ${dirgroup} {
      output digit_${firstdigit} {
      }
      output evens {
      }
    }
  }
}


#############
# References
#############

## references need not be nested; 'default' is an optional name
reference default {
  file = Reference.root
  ## the next line specifies the reference histogram to have the
  ## same name as the input histogram;  one may also
  ## provide a specific name, for example if the same reference is
  ## to be used for many input histograms
  name = same_name
  info = Example reference
}


#############
# Algorithms
#############

algorithm CheckMean {
  libname = libDataQualityInterfacesAlgs.so
  name = AlgCheckMean
  thresholds = CheckMean
  reference = default
  
  algorithm Loose {
    thresholds = CheckMean/Loose
  }
}

algorithm SimpleSummary {
  libname = libdqm_summaries.so
  name = SimpleSummary
}


#############
# Thresholds
#############

thresholds CheckMean {
  limits chi2 {
    warning = 2
    error = 3
  }
  
  thresholds Loose {
    limits chi2 {
      warning = 5
      error = 10
    }
  }
}
